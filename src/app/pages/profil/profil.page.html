<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Profil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Memuat profil...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && error" class="error-container">
    <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
    <p>{{ error }}</p>
    <ion-button (click)="loadProfile()" fill="outline" size="small">
      <ion-icon slot="start" name="refresh-outline"></ion-icon>
      Coba Lagi
    </ion-button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && !error && profile" class="profile-container">
    <!-- Header Card with Avatar -->
    <div class="profile-header">
      <div class="avatar-container">
        <ion-avatar class="profile-avatar">
          <img [src]="getAvatarUrl()" [alt]="getDisplayName()" />
        </ion-avatar>
      </div>
      <h1 class="profile-name">{{ getDisplayName() }}</h1>
      <ion-chip color="primary" class="role-chip">
        <ion-label>{{ getRoleText() }}</ion-label>
      </ion-chip>
    </div>

    <!-- Menu List -->
    <ion-list class="menu-list" lines="none">
      <!-- Group 1: Profile & Security -->
      <div class="menu-group">
        <ion-item
          button
          (click)="openAccountInfo()"
          detail="false"
          class="group-item-first"
        >
          <ion-icon
            name="person-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Informasi Profil</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>

        <ion-item
          button
          (click)="openSecurity()"
          detail="false"
          class="group-item-last"
        >
          <ion-icon
            name="lock-closed-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Keamanan Akun</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>
      </div>

      <!-- Group 2: Help & Info -->
      <div class="menu-group">
        <ion-item
          button
          (click)="openHelpCenter()"
          detail="false"
          class="group-item-first"
        >
          <ion-icon
            name="help-circle-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Pusat Bantuan</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>

        <ion-item
          button
          (click)="openTerms()"
          detail="false"
          class="group-item-middle"
        >
          <ion-icon
            name="document-text-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Syarat & Ketentuan</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>

        <ion-item
          button
          (click)="openPrivacy()"
          detail="false"
          class="group-item-middle"
        >
          <ion-icon
            name="shield-checkmark-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Kebijakan Privasi</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>

        <ion-item
          button
          (click)="openAbout()"
          detail="false"
          class="group-item-last"
        >
          <ion-icon
            name="information-circle-outline"
            slot="start"
            color="primary"
          ></ion-icon>
          <ion-label>Tentang Aplikasi</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>
      </div>

      <!-- Group 3: Logout (standalone) -->
      <div class="menu-group">
        <ion-item
          button
          (click)="logout()"
          detail="false"
          class="logout-item group-item-single"
        >
          <ion-icon
            name="log-out-outline"
            slot="start"
            color="danger"
          ></ion-icon>
          <ion-label color="danger">Keluar</ion-label>
          <ion-icon
            name="chevron-forward-outline"
            slot="end"
            color="medium"
          ></ion-icon>
        </ion-item>
      </div>
    </ion-list>
  </div>
</ion-content>
